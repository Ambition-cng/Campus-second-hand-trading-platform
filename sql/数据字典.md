# 数据字典

**重复表设计说明**

由于商品区分：卖家发布的商品以及买家希望求购的商品两大类，有两种实现方案：

+ 通过在一张数据库表中增加标志位，以此来区分商品和求购商品，只需创建一张表，但查询代价升高；
+ 创建两张不同的表分别去存储商品及求购商品，需额外创建一张表，但由于商品和求购商品是独立的，故查询代价减半，并且使用起来更加便捷。

**注意：前端同学在创建数据库查询语句时，一定要区分查询的是商品还是求购商品。**

## 用户表 user

在用户注册时，录入用户名(账号)、昵称、密码、手机号等信息，注意区分用户名与昵称，类似 QQ 账号和 QQ 昵称，一个用于登录账号，另一个用于聊天显示，即商品发布、求购商品发布以及留言等，均使用昵称信息。

**除用户表中学号、性别字段可为空值，其余所有字段均不可为空。**

| 字段名   | 字段类型    | 是否可为空值 | 备注                               |
| -------- | ----------- | ------------ | ---------------------------------- |
| uid      | varchar(20) | 否           | 主键，用户名(账号)，用作登录时使用 |
| username | varchar(20) | 否           | 用户昵称                           |
| password | varchar(30) | 否           | 登录密码                           |
| phone    | char(11)    | 否           | 用户手机号码                       |
| stuno    | char(11)    | 是           | 用户学号                           |
| gender   | char(1)     | 是           | 性别                               |

## 商品信息

1. 商品中有关用户的信息仅包含昵称，目的是在获取商品信息时，仅返回需要的信息，商品和用户通过关系表**用户-商品归属关系**建立联系。
2. 有关商品的描述信息包括：品牌、磨损程度、是否有发票凭证、可小刀等等；
3. 商品类别是用户在发布商品时，自己录入的分类标签，如电子产品、书本、日用品等。便于平台的搜索功能实现，使用简单的字符串匹配功能，后端同学可以根据实际情况决定用什么方式存储，例如用逗号或者顿号分隔等；
4. 商品的图片描述，需要有固定的存储路径，发送至前端进行显示。

### 商品表 item

| 字段名   | 字段类型     | 备注                           |
| -------- | ------------ | ------------------------------ |
| itemid   | int          | 主键(自动增加+1)，用作内部标识 |
| username | varchar(20)  | 外键，发布该商品的用户昵称     |
| itemname | varchar(20)  | 商品名称                       |
| remark   | varchar(255) | 商品描述                       |
| price    | varchar(255) | 商品价格                       |
| sort     | varchar(50)  | 商品类别                       |
| count    | int          | 商品数量                       |
| image    | varchar(255) | 商品的图片地址(url)            |

### 求购商品表 want_item

| 字段名   | 字段类型     | 备注                           |
| -------- | ------------ | ------------------------------ |
| itemid   | int          | 主键(自动增加+1)，用作内部标识 |
| username | varchar(20)  | 外键，发表该求购商品的用户昵称 |
| itemname | varchar(20)  | 求购商品名称                   |
| remark   | varchar(255) | 求购商品描述                   |
| price    | varchar(255) | 求购商品价格                   |
| sort     | varchar(50)  | 求购商品类别                   |
| image    | varchar(255) | 求购商品的图片地址(url)        |

## 商品留言

商品留言绑定至每个商品，便于在查询时统一返回至前端。

鉴于每条留言的内容均包括有：留言时间、留言用户昵称、留言内容，故 content 字段采用 json 字符串设计，通过 itemid 查询到所有的关于该商品的留言，使用循环遍历每个 json 字符串，通过设定好的 key-value，获取信息并显示。

### 商品留言 item_comment

| 字段名    | 字段类型     | 备注                                                         |
| --------- | ------------ | ------------------------------------------------------------ |
| commentid | int          | 主键(自动增加+1)，用作内部标识                               |
| itemid    | int          | 外键，绑定商品id                                             |
| content   | varchar(255) | 留言内容，json 字符串格式，包含有留言时间(time)、留言用户昵称(username)、留言内容(msg) |

### 求购商品留言 want_item_comment

| 字段名    | 字段类型     | 备注                                                         |
| --------- | ------------ | ------------------------------------------------------------ |
| commentid | int          | 主键(自动增加+1)，用作内部标识                               |
| itemid    | int          | 外键，绑定求购商品id                                         |
| content   | varchar(255) | 留言内容，json 字符串格式，包含有留言时间(time)、留言用户昵称(username)、留言内容(msg) |

## 用户-商品归属关系

建立用户-商品归属关系表的目的是，在查询"我发布的商品"和"我求购的商品"时，能够更快速的返回结果，并通过关联商品表进行显示。

### 用户-商品表 user_item

| 字段名 | 字段类型    | 备注                           |
| ------ | ----------- | ------------------------------ |
| id     | int         | 主键(自动增加+1)，用作内部标识 |
| uid    | varchar(20) | 外键，绑定用户名(账户)         |
| itemid | int         | 外键，绑定商品id               |

### 用户-求购商品表 user_want_item

| 字段名 | 字段类型    | 备注                           |
| ------ | ----------- | ------------------------------ |
| id     | int         | 主键(自动增加+1)，用作内部标识 |
| uid    | varchar(20) | 外键，绑定用户名(账户)         |
| itemid | int         | 外键，绑定求购商品id           |